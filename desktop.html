<html>
  <head>
      <link rel="stylesheet" href="themes/jquery-mobile-tah.min.css" />
      <link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
      <link rel="stylesheet" href="css/jquery.mobile.structure-1.4.3.min.css" />

      <link rel="stylesheet" href="css/tah.css" />
    <script src='https://cdn.firebase.com/js/client/1.0.15/firebase.js'></script>
    <script src="https://cdn.firebase.com/js/simple-login/1.6.1/firebase-simple-login.js"></script>

    <script src='https://code.jquery.com/jquery-2.1.1.min.js'></script>
    <script src="https://code.jquery.com/mobile/1.4.3/jquery.mobile-1.4.3.min.js"></script>

    <script src="http://underscorejs.org/underscore-min.js"></script>
  </head>
  <body>
    <div data-role="page" id="lobby">
        <div id="prompt"></div>
        <div id="imagediv"></div>
        <button id="start">Start</button>
    </div>
    <div data-role="page" id="music">
        <div class="bop-player" data-bop-container data-width="100%">
            This is the player container. any html in here will be replaced. Style however you like. The element style be set to "display: block;" automatically when the player is loaded, so do not set any inline styles here otherwise they will be overridden.
        </div>
        <button onclick="Bop.playSong('lil jon', 'turn down for what');">Play/Pause</button>
        <!-- BOP Javascript file. All of the above won't happen unless you include this on your page -->
        <script async="true" src="http://assets.bop.fm/embed.js"></script>
        <script>
            window._bopPlayerReady = function(data){
                Bop.on('songStart', function(data){
                    //skip 11 seconds
                    Bop.seekRelative(11);
                });
            }
        </script>
    </div>

  <script type="text/javascript">
    var FIREBASE_URL = "https://vivid-fire-183.firebaseio.com/";
    var usersRef = new Firebase("https://vivid-fire-183.firebaseio.com/users");
    var promptRef = new Firebase("https://vivid-fire-183.firebaseio.com/prompts");
    var gamesRef = new Firebase(FIREBASE_URL + "games");

    var data = {
      "questions": {
        "question1": {
          "text": "What song does Paul Graham listen to in the shower"
        } 
      },
      "players": {
        "user1": {
          "image": "http://www.scarymommy.com/wp-content/uploads/2013/01/531221_8d837de67576fe7e80207347163fb737_large.jpg",
          "name": "Jimmy Jacobson",
        },
        "user2": {
          "image": "http://i.imgur.com/xycC5j1.jpg",
          "name": "Lita Cho"
        }
      }
    };

    var newGame = gamesRef.push(data);

    var currentGameRef = new Firebase(FIREBASE_URL + "games").limit(1);

    currentGameRef.once('child_added', function(snapshot) {
      displayPrompt(snapshot);
    }, function(error) {
      //oops
      console.log(error);
    });

    var playersRef = new Firebase(FIREBASE_URL + "games/" + newGame.name() + "/players");

    playersRef.on('child_added', displayUsers);

    function displayPrompt(snapshot) {
      /*
        var i = 0;
        var rand = Math.floor(Math.random() * snapshot.numChildren());
        var prompt;
        snapshot.val().forEach(function(value) {
            if (i == rand) {
                prompt = value.question
            }
            i++;
        });
        */
        var prompt = snapshot.val().questions.question1.text;
        $('#prompt').append('<p class="text">' + prompt + '</p>');
        $('html').trigger('create');
    }

    function displayUsers (snapshot) {
        console.log(snapshot.val());
        var user = snapshot.val();
        var user_pic = user.image;
        var img = $('<img class="user_img">');
        img.attr('src', user_pic);
        img.appendTo('#imagediv');
        $('#imagediv').append('<p class="text">' + user.name + '</p>');
        $('html').trigger('create');
    }

    $('#start').click(function() {
        $.mobile.changePage('#music')
    });

  </script>
  </body>
</html>