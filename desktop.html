<html>
  <head>
    <script src='https://cdn.firebase.com/js/client/1.0.15/firebase.js'></script>
    <script src="https://cdn.firebase.com/js/simple-login/1.6.1/firebase-simple-login.js"></script>

    <script src='https://code.jquery.com/jquery-2.1.1.min.js'></script>
    <script src="https://code.jquery.com/mobile/1.4.3/jquery.mobile-1.4.3.min.js"></script>

    <script src="http://underscorejs.org/underscore-min.js"></script>
  </head>
  <body>
    <div data-role="page" id="lobby">
        <div id="prompt"></div>
        <div id="imagediv"></div>
        <button id="start">Start</button>
    </div>
    <div data-role="page" id="music">
        <p>Music Page</p>
    </div>
  </body>
  <script type="text/javascript">
    var usersRef = new Firebase("https://vivid-fire-183.firebaseio.com/users");
    var promptRef = new Firebase("https://vivid-fire-183.firebaseio.com/prompts");

    function displayPrompt(snapshot) {
        var i = 0;
        var rand = Math.floor(Math.random() * snapshot.numChildren());
        var prompt;
        snapshot.val().forEach(function(value) {
            if (i == rand) {
                prompt = value.question
            }
            i++;
        });
        $('#prompt').append('<p class="text">' + prompt + '</p>');
        $('html').trigger('create');
    }

    function displayUsers (snapshot) {
        var user = snapshot.val();
        var user_pic = user.thirdPartyUserData.profile_image_url_https;
        if (user.active) {
            var img = $('<img class="user_img">');
            img.attr('src', user_pic);
            img.appendTo('#imagediv');
            $('#imagediv').append('<p class="text">' + user.displayName + '</p>');
            $('html').trigger('create');
        }
    }

    $('#start').click(function() {
        $.mobile.changePage('#music')
    });

    usersRef.on('child_added', displayUsers);
    usersRef.on('child_changed', displayUsers);
    promptRef.on('value', displayPrompt);
  </script>
  </body>
</html>